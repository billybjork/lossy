# Manual Test: Sidepanel IndexedDB Cache

**Last updated:** 2025-10-23  
**Purpose:** Verify IndexedDB-backed caching for notes and the video library in the Chrome sidepanel extension.

---

## Preconditions

- Phoenix backend running locally with websocket endpoints available.
- Extension built and loaded via `chrome://extensions` (Developer Mode → Load unpacked).
- At least one video in the library with notes generated by the agent.

---

## Steps

### 1. Warm Start (Cache Hydration)
1. Open a supported video (e.g., YouTube) in Chrome.
2. Open the Lossy sidepanel.
3. Confirm the console logs show `Rendered from IndexedDB cache, refreshing in background...` after the first load.
4. Observe that notes render without the empty/loading state when revisiting the same video.

### 2. Cold Start Persistence
1. Close and reopen Chrome entirely (or disable/re-enable the extension).
2. Reopen the sidepanel on the same video.
3. Notes and the video library list should populate immediately from cache before realtime updates arrive.

### 3. Offline Resilience
1. With notes cached, disconnect the machine from the network (e.g., disable Wi-Fi).
2. Reopen the sidepanel.
3. Cached notes remain visible; attempting to add/delete a note surfaces an error but the UI does not clear cached entries.

### 4. Delete Flow Consistency
1. While online, delete a note from the sidepanel.
2. Confirm the note disappears immediately.
3. Refresh the sidepanel; the note remains deleted (ensures Dexie removal succeeded).

### 5. Library Tab Cache
1. Open the Library tab.
2. Verify the list renders instantly from cache and then refreshes when the service worker response completes.

---

## Expected Console Signals

- `[Library] Rendered from IndexedDB cache, refreshing in background...`
- `[Notes] ♻️ Restored cached notes for video ...`
- Absence of `[IndexedDB] Failed ...` errors.

To inspect stored data, open the sidepanel DevTools (`Cmd+Opt+Shift+I`) → Application → IndexedDB → `LossyExtensionDB`.

---

## Follow-ups

- Add automated Playwright smoke covering the above scenarios once telemetry guards are in place.
- Hook `navigator.storage.estimate()` logs into the passive telemetry stream to monitor quota usage.

